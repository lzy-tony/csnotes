# 公钥密钥体系

## 公钥密码学

### 目标

Motivation：对称密码体制的局限性。

1. 对称密钥分配困难。
2. 密钥的存储和保存。



### 应用

公钥密码系统的主要应用：

1. 加密/解密。
2. 数字签名：发送方用自己的 **私钥签署报文** ，接收方用对方的 **公钥验证** 对方的签名。
3. 密钥交换：双方协商会话密钥，用于对称密钥数据加密。



### 核心想法

公钥密码体制抽象为陷门单向函数（trapdoor one-way function）。

> 容易计算、难以求逆、通过陷门可以轻易求逆。即：
>
> 1. 给定 $x$，计算 $y = f(x)$ 是容易的；
> 2. 给定 $y$，计算 $x$ 使得 $y = f(x)$ 是困难的；
> 3. 存在 $\delta$，已知 $\delta$ 时，对给定的任何 $y$，若相应的 $x$ 存在，计算 $x$ 使 $y = f(x)$ 是容易的。



## RSA

### RSA 密码体制

密码体制：设 $n = pq$，其中 $p, q$ 均为大素数。设 $\mathcal P = \mathcal C = \mathbb Z_n$，定义

$$
\mathcal K = \{(n, p, q, a, b) | ab \equiv 1 \mod \phi(n) \}
$$

对于 $K = (n, p, q, a, b)$，定义

$$
e_K(x) = x^b \mod n
$$

和

$$
d_K(y) = y^ a \mod n
$$

$(n, b)$ 组成公钥，$(n, a)$ 组成私钥。

> 证明：加密和解密是逆运算。
>
> 由
> 
> $$
> ab = t \phi(n) + 1
> $$
> 
> 可得
> 
> $$
> \begin{align}
> (x^b)^a & \equiv x^{t \phi(n) + 1} \mod n \\
> &\equiv (x^{\phi(n)})^t x \mod n \\
> &\equiv x \mod n
> \end{align}
> $$



### RSA 安全性

对于 RSA 的攻击基本上等同于对于大数质因数分解的运算难度，但对于一些特殊的情况有一些更为容易的攻击方式。

#### 小指数加密问题

使用小指数（例如 $b = 3$）加密可以显著加快公钥加密和签名验证的速度。

但若对同一消息 $m$，使用小指数加密同时发给不同人时容易遭到攻击：

$$
c_1 \equiv m^3 \mod n_1 \\
c_2 \equiv m^3 \mod n_2 \\
c_3 \equiv m^3 \mod n_3
$$

利用中国剩余定理合并，可以解得

$$
x = m^3 \mod M
$$

的结果。而由于 $c_1, c_2, c_3 < n_1, n_2, n_3$，模数可以去掉，进而直接求得消息本身。



#### 同模攻击

问题：若 B 与 C 具有相同的模数，用户 A 加密一消息 $x$ 发送给 B 和 C。

- A：$y_1 = x^{b_1} \mod n$。
- B：$y_2 = x^{b_2} \mod n$。

利用 $y_1, y_2$ 可以恢复出 $x$，具体过程为：

当 $b_1, b_2$ 互素时，有

$$
c_1 b_1 + c_2 b_2 = 1
$$

而

$$
y_1^{c_1}y_2^{c_2} = x^{c_1b_1 + c_2b_2} = x \mod n
$$


#### 较小明文攻击

当 $m$ 比较小时（$m < 2^l$），可以对其进行攻击。

设 $m = r \cdot s$，可以遍历 $2^{\alpha l}$ 范围内所有的 $r, s$，计算 $\frac c {r^e}, s^e$ 进行生日攻击。



#### 素数规模

RSA 的安全性（与效率）高度依赖于素数的规模。

定理（素数个数定理）：$\pi(N) \approx \frac{N}{\ln N}$。

在512位内的素数大约有 $\frac {2^{512}}{\ln(2^{512})} \approx 2^{503}$ 个。



### RSA 算法

由上一节中所看到的，普通的 RSA 算法在应用时容易受到许多特殊情况的攻击，因此在实际应用的 RSA 算法中通常进行部分处理，使得算法更加安全。



####  RSA PKCS #1 v1.5

对于一个常见形式的公钥 $p = (N, b)$，令 $k$ 为 $N$ 的比特长度。

将需要加密的长度为 $D$ 比特的信息 $m$ （8比特倍数）进行填充，得到

$$
00000000 \lvert \rvert 00000010 \lvert \rvert r \lvert \rvert m
$$

其中 $r$ 是随机生成的 $k - D - 3$ 位字符串，字节均不等于0。



#### RSA-OAEP

- 添加了随机性的元素，可以用来将原有的确定性的加密方案（如传统的 RSA 加密方案）转换成为一种可能性的方案。
- 防止对于密文的部分解密（或者其它的信息泄露），通过确保对手在不能反转陷门单向转换的情况下，无法复原明文的任何部分。CCA 安全的加密。



## Diffie-Hellman 密钥交换

Motivation：使两个用户能够安全地交换密钥。

数学基础：计算离散对数非常困难。

### Diffie-Hellman 问题

选定循环群 $G$ 和生成元 $g \in G$，给定两个元素 $h_1, h_2$，令 $h_1 = g^x, h_2 = g^y$，定义

$$
\text{DH}_g(h_1, h_2) = g^{x \cdot y} = h_1^y = h_2^x
$$



### Diffie-Hellman 密钥交换算法

1\. 全局公开素数 $q$ 及原根 $g$。

2\. A、B各自选择私有的 $a, b < q$，计算公开的
   
$$
Y_A = g^a \mod q \\
Y_B = g^b \mod q
$$

3\. 计算各自的会话密钥
   
$$
\begin{align}
K &= (Y_B)^a \mod q \\
&= (Y_A)^b \mod q
\end{align}
$$